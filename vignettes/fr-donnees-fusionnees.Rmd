---
title: "Données fusionnées harmonisées"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Données fusionnées harmonisées}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", eval = FALSE)
```

`qesR` offre un fichier fusionné inter-études via `get_qes_master()`.

## Construire la base fusionnée

```{r}
library(qesR)

master <- get_qes_master(strict = FALSE)
dim(master)
head(master)
```

## Variables harmonisées

Colonnes harmonisées actuelles de `qes_master` :

`qes_code`, `qes_year`, `qes_name_en`, `respondent_id`, `interview_start`, `interview_end`, `interview_recorded`, `language`, `citizenship`, `year_of_birth`, `age`, `age_group`, `gender`, `province_territory`, `education`, `income`, `religion`, `born_canada`, `political_interest`, `ideology`, `turnout`, `vote_choice`, `vote_choice_text`, `party_best`, `party_lean`, `sovereignty_support`, `sovereignty`, `federal_pid`, `provincial_pid`, `survey_weight`, `definibin`, `ethn1`, `influperso`, `luentend`, `occup`, `patron`, `pondam1`, `issue_family_support`, `info_source_primary`, `info_source_secondary`, `party_best_health`, `identity_self_1`, `identity_self_2`, `referendum_intent`, `party_best_anticorruption`, `elites_out_of_touch`, `trust_government`, `gov_tax_waste`, `issue_education`, `feeling_qs_0_100`, `election_timing_eval`, `pr_reform_support`, `democracy_needs_parties`, `parties_all_same`, `feeling_charest_0_100`, `qc_difference_view`, `feeling_boisclair_0_100`, `feeling_dumont_0_100`, `feeling_david_0_100`, `feeling_mckay_0_100`, `leader_most_competent`, `fed_gov_too_interventionist`, `leader_closest_people`, `qc_economy_change`, `federalist_sovereignist_self`, `future_outlook`, `privatize_hydro_support`, `private_healthcare_support`, `gov_role_environment`, `profits_help_poor`, `party_best_health_alt`, `powers_for_quebec`, `party_best_environment`, `party_best_poverty`, `qc_voice_federal`, `party_best_qc_identity`, `party_best_caisse_depot`, `decision_level_a`, `decision_level_b`, `feeling_unions_0_100`, `feeling_business_0_100`, `same_sex_marriage`, `family_values_priority`, `issue_tax_cuts`, `provincial_pid_item`, `provincial_party_lean`, `party_named`, `vote_federal_2006`, `employment_status`, `issue_qc_status`, `home_language`, `gov_role_jobs_income`, `issue_poverty`, `vote_reason_1`, `vote_reason_2`, `interview_weekday`, `gov_satisfaction`, `polling_trust`, `polls_eval`, `previous_vote_2003`

La fusion applique aussi :

- une normalisation des valeurs pour rendre les réponses comparables
- la dérivation de `age_group` lorsque l'âge ou l'année de naissance est disponible
- la conservation des répondants panel et non-panel (pas de fusion entre études)
- le renommage explicite des variables héritées opaques (par ex. `q10`, `q16`, `voteprec`) vers des noms lisibles
- le suivi de la provenance via `attr(master, "source_map")`
- la liste des variables inter-études ajoutées via `attr(master, "crossstudy_variables_added")`
- la table de correspondance anciens/nouveaux noms via `attr(master, "variable_name_map")`

La déduplication s'applique uniquement à l'intérieur d'un même code d'étude
(pas entre enquêtes panel et non-panel).

```{r}
name_map <- attr(master, "variable_name_map")
head(name_map)
```

## Exporter

```{r}
get_qes_master(save_path = "qes_master.csv", strict = FALSE)
get_qes_master(save_path = "qes_master.rds", strict = FALSE)
```
