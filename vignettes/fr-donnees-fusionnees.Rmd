---
title: "Données fusionnées harmonisées"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Données fusionnées harmonisées}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", eval = FALSE)
```

`qesR` offre un fichier fusionné inter-études via `get_qes_master()`.

## Construire la base fusionnée

```{r}
library(qesR)

master <- get_qes_master(strict = FALSE)
dim(master)
head(master)
```

## Variables harmonisées

Les champs harmonisés incluent la démographie (âge, genre, éducation, revenu), le choix de vote, l'identification partisane, les attitudes envers la souveraineté, les thermomètres de chefs, et plus encore. Utilisez `colnames(master)` pour voir la liste complète.

La fusion applique aussi :

- une normalisation des valeurs pour rendre les réponses comparables
- la dérivation de `age_group` lorsque l'âge ou l'année de naissance est disponible
- la conservation des répondants panel et non-panel (pas de fusion entre études)
- le renommage explicite des variables héritées opaques (par ex. `q10`, `q16`, `voteprec`) vers des noms lisibles
- le suivi de la provenance via `attr(master, "source_map")`
- la liste des variables inter-études ajoutées via `attr(master, "crossstudy_variables_added")`
- la table de correspondance anciens/nouveaux noms via `attr(master, "variable_name_map")`

La déduplication s'applique uniquement à l'intérieur d'un même code d'étude
(pas entre enquêtes panel et non-panel).

```{r}
name_map <- attr(master, "variable_name_map")
head(name_map)
```

## Exporter

```{r}
get_qes_master(save_path = "qes_master.csv", strict = FALSE)
get_qes_master(save_path = "qes_master.rds", strict = FALSE)
```
